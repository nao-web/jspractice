<!doctype html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>jQueryの練習</title>
    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <style>
        span {
            cursor:pointer;
        }
    </style>

</head>
<body>
    <h1>間違い探しゲーム！</h1>
    <p><input type="button" value="開始！" onclick="gameStart();"></p>
    <p id="score"></p>
    <div id="cells"></div>
    <script>
        var level = 0;
        var games = [
            ['問', '間'],
            ['大', '太'],
            ['白', '臼']
        ];
        var MAX_LEVEL = games.length - 1;
        var dim = 5;
        var t1;
        var t2;
    
        function gameStart() {
            var dummy = games[level][0];
            var seikai = games[level][1];
            
            if (level == 0) {
                $('#score').empty();
                t1 = new Date().getTime();
            }
            
            var cells = '';
            for (var i = 1; i <= dim * dim; i++) {
                cells += '<span id="s' + i + '"></span>';
                if (i % dim == 0) {
                    cells += '<br />';
                }
            }
            $('#cells').html(cells);
            
            var chars = [];
            for (var i = 0; i < dim * dim; i++) {
                chars.push(dummy);
            }
            
            var offset = Math.floor(Math.random() * chars.length);
            chars.splice(offset, 1, seikai);
 
            for (var i = 1; i <= chars.length; i++) {
                $('#s'+i).text(chars[i - 1]);
                $('#s'+i).click(function() {
                    if ($(this).text() == seikai) {
                        level++;
                        if (level > MAX_LEVEL) {
                            t2 = new Date().getTime();
                            $('#score').text('Your score is '+(t2-t1)/1000+'!!');
                            level = 0;
                            return false;
                        }
                        gameStart();
                    }
                });
            }
        }
    </script>
</body>
</html>